<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <title>List Resorts</title>

  <link
          rel="stylesheet"
          type="text/css"
          href="https://cdn.datatables.net/v/bs4/dt-1.10.25/datatables.min.css"
  />
  <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
          integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
          crossorigin="anonymous"
  />
</head>

<body>


<div class="container">

  <h3>List Resorts</h3>

  <hr />

  <!-- Dropdown list of states -->
  <!--<div class="form-group">
    <label for="stateSelect">Select a State:</label>
    <select class="form-control" id="stateSelect">
      <option value="kolkata">Kolkata</option>
      <option value="mumbai">Mumbai</option>
      <option value="bangalore">Bangalore</option>
      <option value="pune">Pune</option>
      <option value="hyderabad">Hyderabad</option>
      &lt;!&ndash; Add more states as needed &ndash;&gt;
    </select>
  </div>-->

  <!-- Dynamic dropdown list of states -->
  <div class="form-group">
    <label for="stateSelect">Select a State:</label>
    <select class="form-control" id="stateSelect">
      <!-- Options will be dynamically populated here -->
    </select>
  </div>

  <!-- Filter button -->
  <button id="filterButton" class="btn btn-primary">Filter Resorts</button>
  <br />
  <br />

  <a th:href="@{/addResortForm}" class="btn btn-primary">Add Resort</a>
  <br />
  <br />
  <table class="table table-bordered table-striped" id="resortTable">
    <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Address</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="resort: ${resorts}">
      <td th:text="${resort.id}" />
      <td th:text="${resort.name}" />
      <td th:text="${resort.address}" />
      <td>
        <a th:href="@{/resort/{resortId}/roomlist(resortId=${resort.id})}"
        >Room</a
        >
        <!--
        <a
                th:href="@{/showUpdateForm(resortId=${resort.id})}"
                class="btn btn-info"
        >Update</a
        >
        -->
        <a
                th:href="@{/updateResortForm/{id}(id=${resort.id})}"
                class="btn btn-info"
        >Update</a
        >
        <!--
        <a
                th:href="@{/deleteResort/{resortId}(resortId=${resort.id})}"
                class="btn btn-danger ml-2"
                onsubmit="return confirm('Are you sure you want to delete this resort?');"
        >Delete</a
        >
        -->

        <a th:href="@{/deleteResort/{id}(id=${resort.id})}"
           class="btn btn-danger ml-2"
           onclick="return confirm('Are you sure you want to delete this resort?');"
        >Delete</a>

      </td>
    </tr>
    </tbody>
  </table>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script
        type="text/javascript"
        src="https://cdn.datatables.net/v/bs4/dt-1.10.25/datatables.min.js"
></script>

<script>
  var states = [
    { value: "kolkata", name: "Kolkata" },
    { value: "mumbai", name: "Mumbai" },
    { value: "bangalore", name: "Bangalore" },
    { value: "pune", name: "Pune" },
    { value: "hyderabad", name: "Hyderabad" }
    // Add more states as needed
  ];

  $(document).ready(function () {
  var stateSelect = $("#stateSelect");

  // Populate the dynamic dropdown options
  states.forEach(function (state) {
    stateSelect.append($("<option>").val(state.value).text(state.name));
  });

  // DataTables initialization
  var resortsTable = $("#resortTable").DataTable({
    aoColumnDefs: [
      {
        bSortable: false,
        aTargets: [-1],
      },
    ],
    pageLength: 3,
  });

  // Add event listener for filter button click
  $("#filterButton").on("click", function () {
    var selectedState = $("#stateSelect").val();
    filterResortsByState(selectedState);
  });

  // Function to filter resorts by selected state
  function filterResortsByState(state) {
    resortsTable.clear().draw();

    // Fetch the resorts data from the server
    $.get("/resort", function (data) { // Update the URL here
      // Create a mapping of states to resorts
      var stateResortsMapping = {};

      // Populate the mapping
      data.forEach(function (resort) {
        var stateName = resort.address.toLowerCase(); // Assuming the "address" field contains the state name
        if (!stateResortsMapping[stateName]) {
          stateResortsMapping[stateName] = [];
        }
        stateResortsMapping[stateName].push(resort);
      });

      // Filter and add resorts based on the selected state
      var filteredResorts = stateResortsMapping[state.toLowerCase()] || [];
      filteredResorts.forEach(function (resort) {
        resortsTable.row.add([
          resort.id,
          resort.name,
          resort.address,
          // Add action buttons here if needed
        ]);
      });

      resortsTable.draw();
    });
  }
});

</script>

</body>
</html>
